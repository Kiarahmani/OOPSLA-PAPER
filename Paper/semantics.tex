\begin{figure*}[h]
\raggedright

\vspace{5mm}
\textbf{Auxiliary Reduction} \;
  \fbox{\(\auxred{v} {(\E,\langle s,i,op \rangle)} {} {(\E',\eff)}\)}\\

\begin{minipage}{\textwidth}
\rulelabel{Oper}
\begin{smathpar}
\stretcharraybig
\begin{array}{l}
\RuleTwo
{
%\Theta(\rho \mapsto (v,cache)) \qquad
F_{op}(v) = \eta \qquad
\ssn(\eta) = s \qquad 
\id(\eta) = i \qquad
%\{\eff'\} = \EffSoup_{({\sf SessID}=s,\,{\sf SeqNo}=i-1)}\\
\EffSoup' = \EffSoup \cup \{\eff\} \\
\visZ' = \visZ \cup S \times\{\eff\}\qquad
\soZ' = \soZ \cup \{(\eta',\eta) \,|\, \eta'\in \EffSoup \conj 
    \ssn(\eta')=s \conj \id(\eta')<i\}\qquad
%\soZ' = (\soZ^{-1}(\eff') \cup \eff') \times\{\eff\} \cup \soZ
}
{
  \auxred {v} {((\EffSoup,\visZ,\soZ), \langle s,i,op \rangle}
  {} {((\EffSoup',\visZ',\soZ'),\eta)}
}
\end{array}
\end{smathpar}
\end{minipage}


\vspace{5mm}
\textbf{Operational Semantics} \;
  \fbox{\((\E,\Theta,\Sigma) \;\xrightarrow{\eff}\; (\E',\Theta',\Sigma')\)}\\

\begin{minipage}{3in}
\rulelabel{Pool Refresh}
\begin{smathpar}
\stretcharraybig
\begin{array}{l}
\RuleTwo
{ 
  \eta \in \E.\EffSoup \spc
  \Theta(\rho) = (\Pool,\Cache,\Avail) \spc
  \eta \not\in \Pool_e \\
  \Pool' = (apply \; \eta\; \Pool_v,\Pool_e \cup \{\eta\}) \spc \\
  \Theta' = \Theta[\rho \mapsto (\Pool',\Cache,\Avail)]\\
}
{
  (\E,\Theta,\Sigma) \;\xrightarrow{\eff}\; (\E, \Theta', \Sigma)
}
\end{array}
\end{smathpar}
\end{minipage}
%
\begin{minipage}{2.8in}
\rulelabel{Avail Refresh}
\begin{smathpar}
\stretcharraybig
\begin{array}{l}
\RuleTwo
{
  \Theta(\rho) = (\Pool,\Cache,\Avail) \spc \eta \in \Pool_e \spc
  \oper(\eta) = op 
  \\ \Avail_{op}(\eta) < i < k  \spc
  \Avail_{op}'= \Avail_{op}[\eta \mapsto i] \spc \\ \psi_{i}^{-1}
  (\eta) \subseteq \Pool_e
 \spc  \Theta' = \Theta[\rho \mapsto (\Pool,\Cache,\Avail[op \mapsto
 \Avail'_{op}])]\\
}
{
  (\E,\Theta,\Sigma) \;\xrightarrow{\eff}\; (\E, \Theta', \Sigma)
}
\end{array}
\end{smathpar}
\end{minipage}
%
\vspace{5mm}
\begin{minipage}{2.8in}
\rulelabel{Cache Refresh}
\begin{smathpar}
\stretcharraybig
\begin{array}{l}
\RuleTwo
{
  \Theta(\rho) = (\Pool,\Cache,\Avail) \spc \eta \in \Pool_e \spc
  \oper(\eta) = op 
  \\ \eta \not\in \Cache(op)_e \spc
  \Cache'=(apply \; \eta \; \Cache(op)_v ,\Cache(op)_e \cup \{\eta\}) \\ \psi^{-1}
  (\eta) \subseteq \Cache_e
 \spc  \Theta' = \Theta[\rho \mapsto (\Pool,\Cache',\Avail)]\\
}
{
  (\E,\Theta,\Sigma) \;\xrightarrow{\eff}\; (\E, \Theta', \Sigma)
}
\end{array}
\end{smathpar}
\end{minipage}
\hspace{22 mm}
\vspace{3mm}
\begin{minipage}{2.3in}
\rulelabel{Exec}
\begin{smathpar}
\stretcharraybig
\begin{array}{l}
\RuleTwo
{
  \auxred{\CacheFinder_{\psi}(\Theta(\rho))} {(\E,\langle s,i,op \rangle)} {} {(\E',\eta)}  \\
  \Theta(\rho) = (\Pool,\Cache) \spc \psi^{-1}(\eta) \subseteq \Pool_e  \spc
}
{
  (\E,\Theta,\langle s,i,op::\sigma \rangle \pll \Sigma) 
    \;\xrightarrow{\eff}\;
  (\E',\Theta,\langle s,i+1,\sigma \rangle \pll \Sigma) 
}
\end{array}
\end{smathpar}
\end{minipage}


\caption{Operational semantics of a replicated data store.}
\label{sem:oper}
\end{figure*}

